# ENDEF
论文全称：**Generalizing to the Future: Mitigating Entity Bias in Fake News Detection**

论文地址：https://dl.acm.org/doi/abs/10.1145/3477495.3531816 

官方公开代码：https://github.com/ICTMCG/ENDEF-SIGIR2022 

* 这篇论文介绍了一种称为**实体去偏差框架-ENDEF**的方法，旨在提升假新闻检测模型对未来数据的适应能力。研究发现现有方法忽视了现实世界中**特定实体**在不同
时间段**真实性的变化**，导致模型泛化能力下降。ENDEF框架通过**因果图**建模实体、新闻内容和真实性之间的关系，在训练中**减少了对特定实体的过度依赖**，从而显著提升了检测器的性能，并在实际测试中得到验证。

# Introduction
本工作旨在利用该论文所提出的方法，结合课程提供的**新的新闻数据集**，验证该方法的性能，评估其在假新闻检测领域的性能表现。

# Dataset
#### 这里使用到了两份数据集： 

数据集1是原论文中的英文数据集，来源于FakeNewsNet的GossipCop数据：https://github.com/KaiDMML/FakeNewsNet 

数据集2是课程提供的基于风格的新闻数据集：https://github.com/junyachen/Data-examples/blob/main/README.md#style-based-fake
#### 数据集处理：
数据集1（ENDEF_en/data）中原作者已经将数据进行划分和实体提取，但并未给出处理具体代码。 因此我对数据集2首先进行划分，然后使用texsmart工具提取其中的实体信息，详见代码（reexperiment/test.py和reexperiment/utils/texsmart.py）。处理后的数据集在（reexperiment/datanew）。

# Code
### Requirements
* Python 3.6
* PyTorch > 1.0
* Pandas
* Numpy
* Tqdm
* bert(预先在官网下载到本地，所有使用的模型都使用预训练的BERT模型作为嵌入层)
### File Structure
整个代码结构可以分成两大部分：
* ENDEF_en：这一部分包含了原作者的代码和数据集1，并未进行任何改动（除了为了与实验的其他部分保持一致而调整了一些训练参数）。这部分代码主要用于**复现原作者的实验结果**，确保实验的准确性。
* reexperiment：这部分涉及新数据集2的使用，并对原有代码进行了部分修改，以适应新数据集的结构。reexperiment 部分用于**测试新数据集的性能**，并进行了**消融实验**，即使用修改后的代码对数据集1进行训练，以评估不同组件对模型性能的影响。

下面以reexperiment结构为例介绍代码结构，ENDEF_en结构类似。
```python
├── ENDEF-glj<br>
│   └── readme.md<br>
│   ENDEF_en       (复现原文数据集)<br>
└── reexperiment(新数据集实验及消融实验)<br>
    ├── main.py<br>
    ├── grid_search.py<br>
    ├── test.py<br>
    ├── data       (原文数据集消融版)<br>
    │   ├── train.json<br>
    │   ├── val.json<br>
    │   ├── test.json<br>
    ├── datanew    (新数据集)<br>
    │   ├── train.json<br>
    │   ├── val.json<br>
    │   ├── test.json<br>
    ├── logs       (日志信息)<br>
    ├── models(训练)<br>
    │   ├── bigru.py<br>
    │   ├── bigruendef.py<br>
    │   └── ...<br>
    ├── param_model           (训练结果)<br>
    │	│   ├── origin... .json   (消融)<br>
    │   │   ├── ... .json         (新数据集)<br>
    │	│   └── ...<br>
    └── utils     (数据加载/实体提取/评价指标等等)<br>                
        ├── dataloader.py<br>
        ├── texsmart.py<br>
        ├── draw.py<br>
        └── utils.py<br>
```
# Run
因为此框架与方法无关，因此这里使用论文中相同的五种基础模型进行实验，即BiGRU、EANN、BERT、MDFEND和BERT-Emo，_endef后缀表示该方法与ENDEF框架结合。
```python  
# --model_name可选：bigru, bigru_endef, bert, bert_endef, bertemo, bertemo_endef, eann, eann_endef, mdfend, mdfend_endef
python main.py --gpu 0 --lr 0.0001 --model_name bigru 
```
# Results
* 复现结果以bigru结果为例，其他模型结果详见ENDEF_en/param_model
 ```python
#训练轮次与损失
{"epoch": 0, "loss": 0.586040031534058}
{"epoch": 1, "loss": 0.48914683053085384}
{"epoch": 2, "loss": 0.4216875719863015}
{"epoch": 3, "loss": 0.4038632525517059}
{"epoch": 4, "loss": 0.374089220756883}
{"epoch": 5, "loss": 0.35454239233120055}
{"epoch": 6, "loss": 0.3283975810349523}
{"epoch": 7, "loss": 0.2919253204856908}
```
```python
#训练轮次与评价指标
{"epoch": 0, "results": {"auc": 0.7795913377184797, "spauc": 0.6552021905035479, "metric": 0.4307702095510756, "f1_real": 0.8549397590361446, "f1_fake": 0.006600660066006601, "recall": 0.5016556291390728, "recall_real": 1.0, "recall_fake": 0.0033112582781456954, "precision": 0.8733164983164983, "precision_real": 0.7466329966329966, "precision_fake": 1.0, "acc": 0.7468460891505467}}
{"epoch": 1, "results": {"auc": 0.8142326242935112, "spauc": 0.6922404209677527, "metric": 0.7180384704023728, "f1_real": 0.8883062401678028, "f1_fake": 0.5477707006369427, "recall": 0.6910282446224718, "recall_real": 0.9549041713641488, "recall_fake": 0.4271523178807947, "precision": 0.7968528831651004, "precision_real": 0.8303921568627451, "precision_fake": 0.7633136094674556, "acc": 0.8208578637510513}}
{"epoch": 2, "results": {"auc": 0.820174783666948, "spauc": 0.7017254380790969, "metric": 0.7541143494311593, "f1_real": 0.8896719978313906, "f1_fake": 0.6185567010309279, "recall": 0.7356929003934686, "recall_real": 0.9250281848928974, "recall_fake": 0.5463576158940397, "precision": 0.7848310203068871, "precision_real": 0.8569190600522193, "precision_fake": 0.712742980561555, "acc": 0.828847771236333}}
{"epoch": 3, "results": {"auc": 0.8222970501056467, "spauc": 0.7081758391513999, "metric": 0.735021585185534, "f1_real": 0.8568135983866321, "f1_fake": 0.6132295719844358, "recall": 0.7452682977817929, "recall_real": 0.8382187147688839, "recall_fake": 0.652317880794702, "precision": 0.7274065747881941, "precision_real": 0.8762522097819682, "precision_fake": 0.57856093979442, "acc": 0.7910008410428931}}
{"epoch": 4, "results": {"auc": 0.8254869826858896, "spauc": 0.7069930363961375, "metric": 0.7516845295934795, "f1_real": 0.8803324099722992, "f1_fake": 0.6230366492146597, "recall": 0.7433877494643004, "recall_real": 0.8957158962795941, "recall_fake": 0.5910596026490066, "precision": 0.7620699981509619, "precision_real": 0.8654684095860566, "precision_fake": 0.6586715867158671, "acc": 0.8183347350714887}}
{"epoch": 5, "results": {"auc": 0.8191220499189918, "spauc": 0.6977840720873089, "metric": 0.7417231483081279, "f1_real": 0.8895426584648302, "f1_fake": 0.5939036381514258, "recall": 0.7187147688838782, "recall_real": 0.9374295377677565, "recall_fake": 0.5, "precision": 0.7887726496990308, "precision_real": 0.8463104325699745, "precision_fake": 0.7312348668280871, "acc": 0.8263246425567704}}
{"epoch": 6, "results": {"auc": 0.8199554641361237, "spauc": 0.6989570508994214, "metric": 0.7409626923472772, "f1_real": 0.8813744205072266, "f1_fake": 0.6005509641873278, "recall": 0.7261632334605076, "recall_real": 0.910935738444194, "recall_fake": 0.5413907284768212, "precision": 0.7639491125742699, "precision_real": 0.8536714210248283, "precision_fake": 0.6742268041237114, "acc": 0.8170731707317073}}
{"epoch": 7, "results": {"auc": 0.8148168541926427, "spauc": 0.6914761181906812, "metric": 0.7381369697080928, "f1_real": 0.8830536004331349, "f1_fake": 0.5932203389830508, "recall": 0.7204571925606815, "recall_real": 0.919391206313416, "recall_fake": 0.5215231788079471, "precision": 0.7686260462154294, "precision_real": 0.8494791666666667, "precision_fake": 0.6877729257641921, "acc": 0.8183347350714887}}
```
* 新数据集实验结果以bert_endef为例，其他模型结果详见reexperiment/param_model
```python
#训练轮次与损失
{"epoch": 0, "loss": 0.4403412370262919}
{"epoch": 1, "loss": 0.26601246069814677}
{"epoch": 2, "loss": 0.2191990663775721}
{"epoch": 3, "loss": 0.2061071116477251}
{"epoch": 4, "loss": 0.18918408428293623}
{"epoch": 5, "loss": 0.17716272160209517}
{"epoch": 6, "loss": 0.15237786814671103}
{"epoch": 7, "loss": 0.14775428183477474}
{"epoch": 8, "loss": 0.13613982735252064}
{"epoch": 9, "loss": 0.12872902512852408}
```
```python
#训练轮次与评价指标
{"epoch": 0, "results": {"auc": 0.979447316642016, "spauc": 0.9235180968317074, "metric": 0.9157898723650908, "f1_real": 0.8719309887193099, "f1_fake": 0.9596487560108719, "recall": 0.9159790603472397, "recall_real": 0.8725099601593626, "recall_fake": 0.9594481605351171, "precision": 0.9156011102642868, "precision_real": 0.8713527851458885, "precision_fake": 0.9598494353826851, "acc": 0.9386327503974563, "accuracy_real": 0.9594481605351171, "accuracy_fake": 0.8725099601593626}}
{"epoch": 1, "results": {"auc": 0.986992387195921, "spauc": 0.9504566373361218, "metric": 0.9167238610895749, "f1_real": 0.8762376237623762, "f1_fake": 0.9572100984167736, "recall": 0.9377198563605111, "recall_real": 0.9402390438247012, "recall_fake": 0.935200668896321, "precision": 0.9003372151240552, "precision_real": 0.8203939745075318, "precision_fake": 0.9802804557405784, "acc": 0.9364069952305246, "accuracy_real": 0.935200668896321, "accuracy_fake": 0.9402390438247012}}
{"epoch": 2, "results": {"auc": 0.9901131260909538, "spauc": 0.9614579293574982, "metric": 0.9418319810769153, "f1_real": 0.9126832377310389, "f1_fake": 0.9709807244227918, "recall": 0.9545285968722657, "recall_real": 0.950863213811421, "recall_fake": 0.9581939799331104, "precision": 0.9307821668813511, "precision_real": 0.8774509803921569, "precision_fake": 0.9841133533705453, "acc": 0.9564387917329094, "accuracy_real": 0.9581939799331104, "accuracy_fake": 0.950863213811421}}
{"epoch": 3, "results": {"auc": 0.9917551088844178, "spauc": 0.9674329730307193, "metric": 0.8960745326787223, "f1_real": 0.8501424501424502, "f1_fake": 0.9420066152149945, "recall": 0.9418402199451914, "recall_real": 0.9907038512616202, "recall_fake": 0.8929765886287625, "precision": 0.8706222645702528, "precision_real": 0.7445109780439122, "precision_fake": 0.9967335510965936, "acc": 0.9163751987281399, "accuracy_real": 0.8929765886287625, "accuracy_fake": 0.9907038512616202}}
{"epoch": 4, "results": {"auc": 0.9929451647146087, "spauc": 0.9727032140171346, "metric": 0.945321604600422, "f1_real": 0.9179910998092816, "f1_fake": 0.9726521093915624, "recall": 0.9589307208179545, "recall_real": 0.9588313413014609, "recall_fake": 0.9590301003344481, "precision": 0.9335772357723577, "precision_real": 0.8804878048780488, "precision_fake": 0.9866666666666667, "acc": 0.9589825119236884, "accuracy_real": 0.9590301003344481, "accuracy_fake": 0.9588313413014609}}
{"epoch": 5, "results": {"auc": 0.9932099916943153, "spauc": 0.9742232735431564, "metric": 0.9447683607881705, "f1_real": 0.9177057356608479, "f1_fake": 0.971830985915493, "recall": 0.9646733578506487, "recall_real": 0.9774236387782205, "recall_fake": 0.9519230769230769, "precision": 0.9287271142109852, "precision_real": 0.8648648648648649, "precision_fake": 0.9925893635571055, "acc": 0.9580286168521462, "accuracy_real": 0.9519230769230769, "accuracy_fake": 0.9774236387782205}}
{"epoch": 6, "results": {"auc": 0.9945641070056452, "spauc": 0.9796729294755497, "metric": 0.9584956250784844, "f1_real": 0.9374597034171502, "f1_fake": 0.9795315467398186, "recall": 0.9678945866478346, "recall_real": 0.9654714475431607, "recall_fake": 0.9703177257525084, "precision": 0.9499747985216556, "precision_real": 0.9110275689223057, "precision_fake": 0.9889220281210055, "acc": 0.9691573926868045, "accuracy_real": 0.9703177257525084, "accuracy_fake": 0.9654714475431607}}
{"epoch": 7, "results": {"auc": 0.9951942508672111, "spauc": 0.9810153272961082, "metric": 0.941689422885118, "f1_real": 0.9136558481322719, "f1_fake": 0.9697229976379643, "recall": 0.967341892185994, "recall_real": 0.9907038512616202, "recall_fake": 0.9439799331103679, "precision": 0.9223183825005017, "precision_real": 0.8477272727272728, "precision_fake": 0.9969094922737307, "acc": 0.9551669316375199, "accuracy_real": 0.9439799331103679, "accuracy_fake": 0.9907038512616202}}
{"epoch": 8, "results": {"auc": 0.9956014848077035, "spauc": 0.9836799606713087, "metric": 0.937800433030898, "f1_real": 0.9080949482653682, "f1_fake": 0.9675059177964278, "recall": 0.9652515911826496, "recall_real": 0.9907038512616202, "recall_fake": 0.939799331103679, "precision": 0.9175490171653504, "precision_real": 0.8382022471910112, "precision_fake": 0.9968957871396896, "acc": 0.9519872813990461, "accuracy_real": 0.939799331103679, "accuracy_fake": 0.9907038512616202}}
{"epoch": 9, "results": {"auc": 0.9961486273412481, "spauc": 0.9848239501069826, "metric": 0.9534979537341305, "f1_real": 0.9306683322923173, "f1_fake": 0.9763275751759437, "recall": 0.973157814672192, "recall_real": 0.9893758300132802, "recall_fake": 0.9569397993311036, "precision": 0.9375274660960564, "precision_real": 0.8785377358490566, "precision_fake": 0.9965171963430561, "acc": 0.9647058823529412, "accuracy_real": 0.9569397993311036, "accuracy_fake": 0.9893758300132802}}

```
* 消融实验结果以eann_endef为哩，其他模型结果详见reexperiment/param_model（以origin开头）
```python
#训练轮次与损失
{"epoch": 0, "loss": 0.7006581559911504}
{"epoch": 1, "loss": 0.5800240496257403}
{"epoch": 2, "loss": 0.49441084024068505}
{"epoch": 3, "loss": 0.4397736358212995}
{"epoch": 4, "loss": 0.3892178206561922}
{"epoch": 5, "loss": 0.33494768137330405}
{"epoch": 6, "loss": 0.27515657407206456}
{"epoch": 7, "loss": 0.22091677516430347}
{"epoch": 8, "loss": 0.16507140889361094}
{"epoch": 9, "loss": 0.13100559925576602}

```
```python
#训练轮次与评价指标
{"epoch": 0, "results": {"auc": 0.7788568506088683, "spauc": 0.644444972754276, "metric": 0.542580351834365, "f1_real": 0.8641975308641975, "f1_fake": 0.22096317280453256, "recall": 0.5578051621284634, "recall_real": 0.9864712514092446, "recall_fake": 0.1291390728476821, "precision": 0.7667993383645197, "precision_real": 0.7688927943760984, "precision_fake": 0.7647058823529411, "acc": 0.768713204373423}}
{"epoch": 1, "results": {"auc": 0.8173590942010048, "spauc": 0.7046382372230777, "metric": 0.735363316903545, "f1_real": 0.8919418758256275, "f1_fake": 0.5787847579814624, "recall": 0.7083768861479651, "recall_real": 0.95152198421646, "recall_fake": 0.4652317880794702, "precision": 0.8025254831397342, "precision_real": 0.8393833913475882, "precision_fake": 0.7656675749318801, "acc": 0.8280067283431455}}
{"epoch": 2, "results": {"auc": 0.8313694124849743, "spauc": 0.7219765144885478, "metric": 0.7579937224700707, "f1_real": 0.8845941468801767, "f1_fake": 0.6313932980599647, "recall": 0.7478796001104997, "recall_real": 0.90304396843292, "recall_fake": 0.5927152317880795, "precision": 0.7711774074981622, "precision_real": 0.8668831168831169, "precision_fake": 0.6754716981132075, "acc": 0.8242220353238016}}
{"epoch": 3, "results": {"auc": 0.8392583826724505, "spauc": 0.7296038239502233, "metric": 0.763815984279523, "f1_real": 0.8790276992651216, "f1_fake": 0.6486042692939245, "recall": 0.765261839521566, "recall_real": 0.8765501691093573, "recall_fake": 0.6539735099337748, "precision": 0.7624208749732249, "precision_real": 0.8815192743764172, "precision_fake": 0.6433224755700325, "acc": 0.8200168208578638}}
{"epoch": 4, "results": {"auc": 0.8436886371950992, "spauc": 0.7291008380609422, "metric": 0.7714163454770402, "f1_real": 0.8998384491114702, "f1_fake": 0.6429942418426103, "recall": 0.7482874411103728, "recall_real": 0.9419391206313416, "recall_fake": 0.554635761589404, "precision": 0.8130901944169844, "precision_real": 0.8613402061855671, "precision_fake": 0.7648401826484018, "acc": 0.8435660218671153}}
{"epoch": 5, "results": {"auc": 0.8448141663617971, "spauc": 0.7300783204043693, "metric": 0.7655225755559852, "f1_real": 0.8959740610645771, "f1_fake": 0.6350710900473934, "recall": 0.7446234050337099, "recall_real": 0.9346110484780158, "recall_fake": 0.554635761589404, "precision": 0.8015992829173939, "precision_real": 0.8604047742605085, "precision_fake": 0.7427937915742794, "acc": 0.8380992430613962}}
{"epoch": 6, "results": {"auc": 0.8443596616319613, "spauc": 0.7276017043362493, "metric": 0.7667124085935851, "f1_real": 0.8829637945551502, "f1_fake": 0.6504610226320201, "recall": 0.7645404182563444, "recall_real": 0.8866967305524239, "recall_fake": 0.6423841059602649, "precision": 0.7690028954533505, "precision_real": 0.8792621576299608, "precision_fake": 0.6587436332767402, "acc": 0.8246425567703953}}
{"epoch": 7, "results": {"auc": 0.8421729992459142, "spauc": 0.724030701001217, "metric": 0.7584350920038738, "f1_real": 0.8967914438502674, "f1_fake": 0.6200787401574803, "recall": 0.7334222432934887, "recall_real": 0.9453213077790305, "recall_fake": 0.5215231788079471, "precision": 0.8087820620450572, "precision_real": 0.853001017293998, "precision_fake": 0.7645631067961165, "acc": 0.8376787216148024}}
{"epoch": 8, "results": {"auc": 0.8399135414411253, "spauc": 0.7220069687123128, "metric": 0.7576363581272226, "f1_real": 0.889010089991819, "f1_fake": 0.6262626262626263, "recall": 0.7416985224396545, "recall_real": 0.9188275084554679, "recall_fake": 0.5645695364238411, "precision": 0.7820799363907178, "precision_real": 0.8610670892762811, "precision_fake": 0.7030927835051546, "acc": 0.828847771236333}}
{"epoch": 9, "results": {"auc": 0.8380469922426216, "spauc": 0.7193407505413975, "metric": 0.7617959584178293, "f1_real": 0.8825006977393246, "f1_fake": 0.6410912190963342, "recall": 0.7568614348536998, "recall_real": 0.891206313416009, "recall_fake": 0.6225165562913907, "precision": 0.7673859758034666, "precision_real": 0.8739635157545605, "precision_fake": 0.6608084358523726, "acc": 0.8229604709840201}}

```
